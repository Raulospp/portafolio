{% extends "base.html" %}
{% block content %}
<section class="home card">
  <a class="back" href="{{ url_for('menu') }}">‚Üê Volver al inicio</a>

  <div class="home-head">
    <h2>Hola, {{ passenger.name }}</h2>
    <div class="home-actions">
      <a class="btn" href="{{ url_for('my_requests', passenger_id=passenger.id) }}">üìã Mis Viajes</a>
      <a class="btn ghost" href="{{ url_for('directory', role='passenger', self_id=passenger.id) }}">üîé Directorio</a>
    </div>
  </div>

  <p class="muted">Conductores relevantes: {{ conductores|length }}</p>

  <div class="carousel" id="carousel-drivers">
    <button class="carousel-btn prev" data-target="drivers">&#10094;</button>
    <div class="carousel-track">
      {% for d in conductores %}
      <div class="slide card">
        <div class="slide-top">
          <div class="avatar default">{{ d.name[0:2].upper() }}</div>
          <div class="info">
            <h3>{{ d.name }}</h3>
            <p class="muted">{{ d.model }} ¬∑ {{ d.plate }}</p>
            <p class="muted">Ruta: {{ d.route }}</p>
          </div>
        </div>
        <div class="slide-actions">
          <button class="btn schedule" data-role="passenger" data-self="{{ passenger.id }}" data-target="{{ d.id }}">
            Pedir viaje
          </button>
          <button class="btn ghost chat" data-name="{{ d.name }}">Contactar</button>
        </div>
      </div>
      {% endfor %}
    </div>
    <button class="carousel-btn next" data-target="drivers">&#10095;</button>
  </div>

  <div id="notifications"></div>
</section>

<style>
/* --- Estilos generales --- */
body {
  background-color: #2c2c2c;
  color: #f5f5f5;
  font-family: 'Poppins', sans-serif;
}

.home.card {
  background-color: #333;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 0 12px rgba(0,0,0,0.5);
  margin: 20px;
}

.back {
  display: inline-block;
  margin-bottom: 15px;
  color: #aaa;
  text-decoration: none;
  transition: 0.3s;
}
.back:hover { color: #fff; }

.home-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.home-head h2 {
  color: #a982ff;
  font-weight: 600;
}

.home-actions {
  display: flex;
  gap: 10px;
}

.btn {
  background-color: #6a4cff;
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: 0.3s;
}

.btn:hover {
  background-color: #825bff;
}

.btn.ghost {
  background-color: transparent;
  border: 1px solid #6a4cff;
}

.carousel {
  position: relative;
  margin-top: 20px;
}

.carousel-track {
  display: flex;
  overflow-x: auto;
  gap: 15px;
  scroll-behavior: smooth;
  padding: 10px 0;
}

.slide.card {
  min-width: 260px;
  background: linear-gradient(145deg, #3b3b3b, #2a2a2a);
  border-radius: 14px;
  padding: 15px;
  transition: transform 0.3s ease;
}

.slide.card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px rgba(106, 76, 255, 0.6);
}

.avatar.default {
  background-color: #6a4cff;
  color: white;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  margin-right: 10px;
}

.slide-top {
  display: flex;
  align-items: center;
}

.slide-actions {
  margin-top: 12px;
  display: flex;
  justify-content: space-between;
}

.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(106,76,255,0.7);
  border: none;
  color: white;
  padding: 8px 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: 0.3s;
}

.carousel-btn:hover {
  background: #7a5eff;
}

.carousel-btn.prev {
  left: -15px;
}

.carousel-btn.next {
  right: -15px;
}

.muted {
  color: #bbb;
  font-size: 0.9em;
}

#notifications {
  margin-top: 15px;
  text-align: center;
}
</style>

<script>
// --- Manejo de solicitudes de viaje ---
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".schedule").forEach(btn => {
    btn.addEventListener("click", async () => {
      const role = btn.dataset.role;
      const self_id = btn.dataset.self;
      const target_id = btn.dataset.target;

      const formData = new FormData();
      formData.append("role", role);
      formData.append("self_id", self_id);
      formData.append("target_id", target_id);

      const response = await fetch("{{ url_for('schedule_service') }}", {
        method: "POST",
        body: formData
      });

      const result = await response.json();
      const notif = document.getElementById("notifications");
      notif.innerHTML = `<div class='msg'>üöó ${result.message}</div>`;
      notif.style.color = "#a982ff";
    });
  });
});
</script>
{% endblock %}
